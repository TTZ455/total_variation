J = double(imread('lena.jpg'))/255.0;
J = J(1:4:end,1:4:end,:);
[Jx,Jy] = gradients(J);
lapJ = laplacian(J);
divJ = divergence(Jx,Jy);

figure;
subplot(2,2,1);
aux = Jx;
aux = aux - min(min(min(aux)));
aux = aux / (max(max(max(aux)))+1e-2);
imshow(aux);
subplot(2,2,2);
aux = Jy;
aux = aux - min(min(min(aux)));
aux = aux / (max(max(max(aux)))+1e-2);
imshow(aux);
subplot(2,2,3);
aux = lapJ;
aux = aux - min(min(min(aux)));
aux = aux / (max(max(max(aux)))+1e-2);
imshow(aux);
subplot(2,2,4);
aux = divJ;
aux = aux - min(min(min(aux)));
aux = aux / (max(max(max(aux)))+1e-2);
imshow(aux);

L = 0.5;
g = 10.;

T = 10;
S = 10;

I = total_variation(J,g,L,T,S);

aux = J-I;
aux = aux - min(min(min(aux)));
aux = aux / (max(max(max(aux)))+1e-2);

figure;
subplot(1,3,1);
imshow(J);
subplot(1,3,2);
imshow(I);
subplot(1,3,3);
imshow(aux);